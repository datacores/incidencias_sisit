(function(e){CSV=function(){var a=Array.prototype.slice.call(arguments,0);this.formato=a[1]||_.isObject(a[1])?a[1]:{};this.datos=[];this.set_datos(a[0]);this.nombre=a[2]||(new Date).getTime();this.ie=a[3]||!1};CSV.prototype.set_datos=function(a){a=_.clone(a);if(_.isObject(a[0]))this.datos=a;else if(_.isArray(a[0])){var b=a[0],c={};this.datos=[];_.each(a,function(a,d){c={};_.each(b,function(b){c[b]=0<a.length?a.shift():""});this.datos.push(c)})}else this.datos=[]};CSV.prototype.set_formato=function(a){a&&
_.isObject(a)&&(this.formato=a)};CSV.prototype.aplicar_formato=function(a){var b=this,c=[];_.each(a,function(a,d){_.isUndefined(b.formato[d])?c.push(a):b.formato[d]&&(_.isFunction(b.formato[d])?c.push(b.formato[d](a)):c.push(a))});return c};CSV.prototype.datos_2str_csv=function(){var a=this,b="",c="",e=[],d=0,f=0,g;for(0<_.size(this.formato)&&_.each(this.datos,function(b,c){a.datos[c]=a.aplicar_formato(b)});d<this.datos.length;){b="";for(f=0;f<this.datos[d].length;)g=this.datos[d][f],b+='"'+g+'";',
f++;try{c=btoa(b)?c+(b+"\r\n"):c+"**NC**\r\n"}catch(h){e.push(b),console.log("Registro problematico"),console.debug(b),console.log("Error:"),console.debug(h)}d++}return{datos:c,errores:e}};CSV.prototype.descargar=function(a){a=a||this.datos_2str_csv().datos;var b=document.createElement("a"),c=window.URL||window.webkiURL;this.ie?(b.setAttribute("href",c),b.setAttribute("href","data:text/csv;charset=utf-8,%EF%BB%BF"+encodeURI(a)),b.setAttribute("download",this.nombre+".csv"),document.body.appendChild(b),
b.click()):(b.setAttribute("href",c.createObjectURL(new Blob(["\ufeff",a],{type:"text/csv;"}))),b.setAttribute("download",this.nombre+".csv"),b.click(),c.revokeObjectURL(b.href))};e.to__csv=function(a,b,c){(new CSV(this,a,b,c)).descargar()};e.eventos.push(["inicio",function(){this.interno.extender({generar_csv:e.to__csv},Array.prototype)}])})(DAF.API);
