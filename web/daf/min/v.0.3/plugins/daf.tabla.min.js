(function(m){Tabla=function(c,d,e,a){var b=$("#"+c).parent().attr("id");if(b){var b="#"+b+" .rc-handle-container { position: relative; }\r\n\t\t\t\t\t#"+b+" .rc-handle { position: absolute; width: 7px; cursor: ew-resize; margin-left: -3px; z-index: 2; }\r\n\t\t\t\t\t#"+b+" table.rc-table-resizing { cursor: ew-resize; }\r\n\t\t\t\t\t#"+b+" table.rc-table-resizing thead, \r\n\t\t\t\t\t#"+b+" table.rc-table-resizing thead > th,\r\n\t\t    \t\t#"+b+" table.rc-table-resizing thead > th > a { cursor: ew-resize; }",
f=document.createElement("style");f.type="text/css";f.styleSheet?f.styleSheet.cssText=b:f.appendChild(document.createTextNode(b));document.getElementsByTagName("head")[0].appendChild(f)}else throw"La tabla debe de estar dentro de un div con un id.";if(!c)throw"Se necesita un identificador de tabla";this.filtros=d||!1;this.reordenar=e||!1;this.orden=a||!0;this.icono={no_sort:'<i style="margin-top:2px;font-size:1.3em;cursor:pointer;float:right;color:gainsboro;" class="fa fa-reorder"></i>',sort_down:'<i style="margin-top:2px;font-size:1.3em;cursor:pointer;float:right;color:black;" class="fa fa-sort-amount-desc"></i>',
sort_up:'<i style="margin-top:2px;font-size:1.3em;cursor:pointer;float:right;color:black;" class="fa fa-sort-amount-asc"></i>'};this.$tabla=$("#"+c);this.tpl_registro=!1;this.num_columnas=this.ancho_tabla=0;this.ids_columnas=[];this.$cuerpo=$(this.$tabla.find("tbody")[0]);this.tr=$("tr");this.$tabla.parent().css({width:"100%",overflow:"auto"});this.valor_celda_focus=this.identificador=!1;this.cambia_celda=function(a){console.log("CALLBACK POR DEFECTO");console.log("Ha cambiado la celda:");console.debug(a)};
this.cambia_filtro=function(a){a=$(a);id_columna=a.attr("data-filtro-id");val_columna=a.val();console.log("Orden de filtrar columna "+id_columna+" por valor:");console.debug(val_columna)};this.reordena_columna=function(a){console.log("Orden de reordenar por columna "+a+" :");console.log("Orden: "+this.orden)};this.procesar_tabla();this.get_tpl_registro()};Tabla.prototype.reordenar_xcolumna=function(c){var d=this;_.each(this.$tabla.find("tr:nth-child(1) th i"),function(e){$icon=$(e);$icon.parent().attr("data-id")==
c?(e.outerHTML==d.icono.no_sort&&(d.orden=!0),d.orden?$icon.replaceWith(d.icono.sort_up):$icon.replaceWith(d.icono.sort_down),d.orden=!d.orden):$icon.replaceWith(d.icono.no_sort)});this.reordena_columna(c);this.implementa_reordenar()};Tabla.prototype.procesar_tabla=function(){var c=this,d=this.filtros?"<tr>":!1,e="";this.num_columnas=0;this.ids_columnas=[];this.columnas_editables=[];this.metodos=[];$.each(this.$tabla.find("tr:nth-child(1) th"),function(){var a=this.getAttribute("data-id"),b=this.getAttribute("data-campo-filtro")||
!1,f=this.getAttribute("data-sin_filtro")||!1,k=this.getAttribute("data-editable")||!1,h=$(this).attr("width");e=-1<h.search("%")?"%":"px";h=parseInt(h);c.reordenar&&a&&$(this).append(c.icono.no_sort);c.num_columnas++;c.ids_columnas.push(a);c.columnas_editables.push(k);c.ancho_tabla+=isNaN(h)?0:h;d&&(d=a&&!f?b?d+('<th><input data-filtro-id="'+b+'" style="width:100%" value=""/></th>'):d+('<th><input data-filtro-id="'+a+'" style="width:100%" value=""/></th>'):d+"<th></th>")});this.filtros&&(d+="</tr>",
this.$tabla.find("thead").append(d),this.$tabla.find("thead tr:nth-child(2) input").on("keyup",function(a){b&&clearTimeout(b);var b=setTimeout(function(){c.cambia_filtro($(a.currentTarget))},500)}));this.reordenar&&this.implementa_reordenar();this.$tabla.attr("style","width:"+this.ancho_tabla+e+";")};Tabla.prototype.implementa_reordenar=function(){var c=this;this.$tabla.find("tr:nth-child(1) th > i").off("click");this.$tabla.find("tr:nth-child(1) th > i").on("click",function(d){c.reordenar_xcolumna($(d.currentTarget).parent().attr("data-id"))})};
Tabla.prototype.get_tpl_registro=function(){var c=this,d=this.$tabla.find("tbody tr:nth-child(1) td"),e="<tr>";$.each(d,function(a){var b=m.str_to_htmlObj(this.innerHTML);if(c.columnas_editables[a])switch(m.tipo(b)){case "HTMLInputElement":"checkbox"===b.type&&(e+=c.get_celda("checkbox",c.ids_columnas[a],a));break;case "HTMLSelectElement":e+=c.get_celda("select",[this.innerHTML,c.ids_columnas[a]],a);break;case "String":e+=c.get_celda("input","<%="+c.ids_columnas[a]+"%>",a);break;case "HTMLDivElement":e+=
c.get_celda("html",this.outerHTML,a);break;default:e+=c.get_celda("input","<%="+c.ids_columnas[a]+"%>",a)}else e+=c.get_celda("celda","<%="+c.ids_columnas[a]+"%>",a)});e+="</tr>";this.tpl_registro=_.template(e);this.$tabla.find("tbody tr:nth-child(1)").remove()};Tabla.prototype.get_celda=function(c,d,e){d=d||"";switch(c){case "celda":return'<td><span identificador="<%=_identificador%>" fila="<%=_fila_registro%>" columna="'+e+'" style="width:100%">'+d+"</span>";case "input":return'<td><input identificador="<%=_identificador%>" fila="<%=_fila_registro%>" columna="'+
e+'" style="width:100%" value="'+d+'"/></td>';case "select":var a='<td><select identificador="<%=_identificador%>" fila="<%=_fila_registro%>" columna="'+e+'" style="width:100%;">';$.each($(d[0]).find("option"),function(){a+='<option data-valor="<%='+d[1]+'%>" value="'+this.value+'" <% if('+d[1]+' == "'+this.value+'"){ print("selected"); } %> >'+this.innerHTML+"</option>"});return a+"</select></td>";case "checkbox":return'<td><input identificador="<%=_identificador%>" fila="<%=_fila_registro%>" columna="'+
e+'" type="checkbox" <% if('+d+' == 1){ print("checked") } %> style="width: 100%;text-align: center; vertical-align: middle">';case "html":c=$(d);e=c.find("[data-id]");var b=c.find("[data-codigo]"),f=c.find("[data-html]"),k=c.find("[data-append_valor]"),h=c.find("[data-prepend_valor]");$.each(e,function(){$(this).attr("data-id","<%="+$(this).attr("data-id")+"%>")});$.each(b,function(){if($(this).attr("data-codigo")){var a=$(this).html();$(this).removeAttr("data-codigo");$(this).html("<%"+a+"%>")}});
$.each(k,function(){$(this).append("<%="+$(this).attr("data-append_valor")+"%>")});$.each(h,function(){$(this).append("<%="+$(this).attr("data-prepend_valor")+"%>")});$.each(f,function(){$(this).html("<%="+this+"%>")});return c[0].outerHTML.replace("&lt;","<").replace("&gt;",">");default:return'<td><input identificador="<%=_identificador%>" fila="<%=_fila_registro%>" columna="'+e+'" style="width:100%" value="'+d+'"/></td>'}};Tabla.prototype.set_metodo=function(c,d){_.isFunction(d)&&(Tabla.prototype[c]=
d)};Tabla.prototype.carga_registros=function(c,d,e){var a=this;e=e||function(){console.debug("REGISTROS CARGADOS")};this.identificador=d=d||!1;this.$cuerpo.html("");$.each(c,function(b){this._fila_registro=b;d&&(this._identificador=c[b][d]);a.$cuerpo.append(a.tpl_registro(this))});this.comportamientos();e()};Tabla.prototype.comportamientos=function(){var c=this;this.$cuerpo.off("keydown");this.$cuerpo.on("keydown",function(d){function e(){g=c.$cuerpo.find("*[fila="+b+"][columna="+f+"]");var a;a="HTMLSelectElement"==
m.tipo(g[0])?!0:!1;a&&(b>k?(k=b,b++):b<k?(k=b,b--):f>h?(h=f,f++):f<h&&(h=f,f--),e())}var a=document.activeElement,b=parseInt(a.getAttribute("fila")),f=parseInt(a.getAttribute("columna")),k=b,h=f;switch(d.keyCode){case 37:f--;break;case 39:f++;break;case 38:b--;break;case 40:b++;break;default:return d}var g;e();g.focus()});this.$cuerpo.off("focus","input");this.$cuerpo.on("focus","input",function(){c.valor_celda_focus=this.value});this.$cuerpo.off("change","input");this.$cuerpo.on("change","input",
function(){var d={columna:$(c.$tabla.find("thead tr:nth-child(1) th")[e]).attr("data-id"),valor_anterior:c.valor_celda_focus,valor_actual:$(this).val()};d[c.identificador]=$(this).attr("identificador");if(!isNaN(parseInt($(this).attr("fila")))){var e=$(this).attr("columna");c.cambia_celda(this,d,$(this).attr("fila"),e)}});this.$cuerpo.off("change","select");this.$cuerpo.on("change","select",function(){c.cambia_celda(this)});this.ColumnasRedimensionables(this.$tabla)};Tabla.prototype.set_cambia_celda=
function(c){_.isFunction(this.cambia_celda)&&(this.cambia_celda=c)};Tabla.prototype.set_cambia_filtro=function(c){this.cambia_filtro=c};Tabla.prototype.set_reordenar=function(c){this.reordena_columna=c};Tabla.prototype.ColumnasRedimensionables=function(c,d,e){c.css("margin-top","0px");_constants={DATA_API:"resizableColumns",DATA_COLUMNS_ID:"resizable-columns-id",DATA_COLUMN_ID:"resizable-column-id",DATA_TH:"th",CLASS_TABLE_RESIZING:"rc-table-resizing",CLASS_COLUMN_RESIZING:"rc-column-resizing",CLASS_HANDLE:"rc-handle",
CLASS_HANDLE_CONTAINER:"rc-handle-container",EVENT_RESIZE_START:"column:resize:start",EVENT_RESIZE:"column:resize",EVENT_RESIZE_STOP:"column:resize:stop",SELECTOR_TH:"tr:nth-child(1) > th:visible",SELECTOR_TD:"tr:first > td:visible",SELECTOR_UNRESIZABLE:"[data-noresize]"};this.ColumnasRedimensionables.defaults={selector:function(a){return a.find("thead").length?_constants.SELECTOR_TH:_constants.SELECTOR_TD},store:window.store,syncHandlers:!0,resizeFromBody:!0,maxWidth:null,minWidth:.01};this.refreshHeaders=
function(){var a=this.options.selector;"function"===typeof a&&(a=a.call(this,this.$table));this.$tableHeaders=this.$table.find(a);this.assignPercentageWidths();this.createHandles()};this.createHandles=function(){var a=this,b=this.$handleContainer;null!=b&&b.remove();this.$handleContainer=$('<div style="margin-top:'+this.margin_top+"\" class='"+_constants.CLASS_HANDLE_CONTAINER+"' />");this.$table.before(this.$handleContainer);this.$tableHeaders.each(function(b,c){var d=a.$tableHeaders.eq(b),e=a.$tableHeaders.eq(b+
1);0===e.length||d.is(_constants.SELECTOR_UNRESIZABLE)||e.is(_constants.SELECTOR_UNRESIZABLE)||$("<div class='"+_constants.CLASS_HANDLE+"' />").data(_constants.DATA_TH,$(c)).appendTo(a.$handleContainer)});this.bindEvents(this.$handleContainer,["mousedown","touchstart"],"."+_constants.CLASS_HANDLE,this.onPointerDown.bind(this))};this.assignPercentageWidths=function(){var a=this;this.$tableHeaders.each(function(b,c){var d=$(c);a.setWidth(d[0],d.outerWidth()/a.$table.width()*100)})};this.syncHandleWidths=
function(){var a=this,b=this.$handleContainer;b.width(this.$table.width());b.find("."+_constants.CLASS_HANDLE).each(function(b,c){var d=$(c),e=a.options.resizeFromBody?a.$table.height():a.$table.find("thead").height(),l=d.data(_constants.DATA_TH).outerWidth()+(d.data(_constants.DATA_TH).offset().left-a.$handleContainer.offset().left);d.css({left:l,height:e})})};this.saveColumnWidths=function(){var a=this;this.$tableHeaders.each(function(b,c){var d=$(c);a.options.store&&!d.is(_constants.SELECTOR_UNRESIZABLE)&&
a.options.store.set(a.generateColumnId(d),a.parseWidth(c))})};this.restoreColumnWidths=function(){var a=this;this.$tableHeaders.each(function(b,c){var d=$(c);a.options.store&&!d.is(_constants.SELECTOR_UNRESIZABLE)&&(d=a.options.store.get(a.generateColumnId(d)),null!=d&&a.setWidth(c,d))})};this.onPointerDown=function(a){if(1===a.which){if(this.operation)this.onPointerUp(a);var b=$(a.currentTarget);if(!b.is(_constants.SELECTOR_UNRESIZABLE)){var c=b.index(),d=this.$tableHeaders.eq(c).not(_constants.SELECTOR_UNRESIZABLE),
c=this.$tableHeaders.eq(c+1).not(_constants.SELECTOR_UNRESIZABLE),e=this.parseWidth(d[0]),g=this.parseWidth(c[0]);this.operation={$leftColumn:d,$rightColumn:c,$currentGrip:b,startX:this.getPointerX(a),widths:{left:e,right:g},newWidths:{left:e,right:g}};this.bindEvents(this.$ownerDocument,["mousemove","touchmove"],this.onPointerMove.bind(this));this.bindEvents(this.$ownerDocument,["mouseup","touchend"],this.onPointerUp.bind(this));this.$handleContainer.add(this.$table).addClass(_constants.CLASS_TABLE_RESIZING);
d.add(c).add(b).addClass(_constants.CLASS_COLUMN_RESIZING);this.triggerEvent(_constants.EVENT_RESIZE_START,[d,c,e,g],a);a.preventDefault()}}};this.onPointerMove=function(a){var b=this.operation;if(this.operation){var c=(this.getPointerX(a)-b.startX)/this.$table.width()*100;if(0!==c){var d=b.$leftColumn[0],e=b.$rightColumn[0],g=void 0,l=void 0;0<c?(g=this.constrainWidth(b.widths.left+(b.widths.right-b.newWidths.right)),l=this.constrainWidth(b.widths.right-c)):0>c&&(g=this.constrainWidth(b.widths.left+
c),l=this.constrainWidth(b.widths.right+(b.widths.left-b.newWidths.left)));d&&this.setWidth(d,g);e&&this.setWidth(e,l);b.newWidths.left=g;b.newWidths.right=l;return this.triggerEvent(_constants.EVENT_RESIZE,[b.$leftColumn,b.$rightColumn,g,l],a)}}};this.onPointerUp=function(a){var b=this.operation;if(this.operation)return this.unbindEvents(this.$ownerDocument,["mouseup","touchend","mousemove","touchmove"]),this.$handleContainer.add(this.$table).removeClass(_constants.CLASS_TABLE_RESIZING),b.$leftColumn.add(b.$rightColumn).add(b.$currentGrip).removeClass(_constants.CLASS_COLUMN_RESIZING),
this.syncHandleWidths(),this.saveColumnWidths(),this.operation=null,this.triggerEvent(_constants.EVENT_RESIZE_STOP,[b.$leftColumn,b.$rightColumn,b.newWidths.left,b.newWidths.right],a)};this.destroy=function(){var a=this.$table,b=this.$handleContainer.find("."+_constants.CLASS_HANDLE);this.unbindEvents(this.$window.add(this.$ownerDocument).add(this.$table).add(b));b.removeData(_constants.DATA_TH);a.removeData(_constants.DATA_API);this.$handleContainer.remove();this.$table=this.$tableHeaders=this.$handleContainer=
null;return a};this.bindEvents=function(a,b,c,d){b="string"===typeof b?b+this.ns:b.join(this.ns+" ")+this.ns;if(3<arguments.length)a.on(b,c,d);else a.on(b,c)};this.unbindEvents=function(a,b){b="string"===typeof b?b+this.ns:null!=b?b.join(this.ns+" ")+this.ns:this.ns;a.off(b)};this.triggerEvent=function(a,b,c){a=$.Event(a);a.originalEvent&&(a.originalEvent=$.extend({},c));return this.$table.trigger(a,[this].concat(b||[]))};this.generateColumnId=function(a){return this.$table.data(_constants.DATA_COLUMNS_ID)+
"-"+a.data(_constants.DATA_COLUMN_ID)};this.parseWidth=function(a){return a?parseFloat(a.style.width.replace("%","")):0};this.setWidth=function(a,b){b=b.toFixed(2);a.style.width=(0<b?b:0)+"%"};this.constrainWidth=function(a){void 0!=this.options.minWidth&&(a=Math.max(this.options.minWidth,a));void 0!=this.options.maxWidth&&(a=Math.min(this.options.maxWidth,a));return a};this.getPointerX=function(a){return 0===a.type.indexOf("touch")?(a.originalEvent.touches[0]||a.originalEvent.changedTouches[0]).pageX:
a.pageX};this.ns=".rc"+this.count++;this.options=$.extend({},this.ColumnasRedimensionables.defaults,d);this.$window=$(window);this.$ownerDocument=$(c[0].ownerDocument);this.$table=c;this.refreshHeaders();this.restoreColumnWidths();this.syncHandleWidths();this.bindEvents(this.$window,"resize",this.syncHandleWidths.bind(this));this.options.start&&this.bindEvents(this.$table,_constants.EVENT_RESIZE_START,this.options.start);this.options.resize&&this.bindEvents(this.$table,_constants.EVENT_RESIZE,this.options.resize);
this.options.stop&&this.bindEvents(this.$table,_constants.EVENT_RESIZE_STOP,this.options.stop)};return Tabla})(DAF.API);
